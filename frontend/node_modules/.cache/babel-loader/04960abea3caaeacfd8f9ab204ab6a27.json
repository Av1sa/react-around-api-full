{"ast":null,"code":"import _toConsumableArray from\"/Users/Marina/Yandex Practicum/around-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/Marina/Yandex Practicum/around-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/Marina/Yandex Practicum/around-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Switch,Route,Redirect,useHistory}from\"react-router-dom\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import Header from\"./Header\";import ProtectedRoute from\"./ProtectedRoute\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithImage from\"./PopupWithImage\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import Login from\"./Login\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import api from\"../utils/api\";import auth from\"../utils/auth\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setIsEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setIsAddPlacePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setIsEditAvatarPopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isImagePopupOpen=_useState8[0],setIsImagePopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isSuccessTooltipOpen=_useState10[0],setIsSuccessTooltipOpen=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isErrorTooltipOpen=_useState12[0],setIsErrorTooltipOpen=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),selectedCard=_useState14[0],setSelectedCard=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cards=_useState18[0],setCards=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),loggedIn=_useState20[0],setLoggedIn=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),email=_useState22[0],setEmail=_useState22[1];var history=useHistory();useEffect(function(){api.getAppInfo().then(function(_ref){var _ref2=_slicedToArray(_ref,2),cardListData=_ref2[0],userInfoData=_ref2[1];setCurrentUser(userInfoData);setCards(cardListData);}).catch(function(error){console.log(error);});var token=localStorage.getItem(\"jwt\");if(token){validateAndSetUser(token);}},[]);var validateAndSetUser=function validateAndSetUser(token){auth.validateUser(token).then(function(user){setLoggedIn(true);setEmail(user.data.email);history.push(\"/\");}).catch(function(err){return console.log(err);});};var handleEditAvatarClick=function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);};var handleEditProfileClick=function handleEditProfileClick(){setIsEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);};var openSuccessTooltip=function openSuccessTooltip(){setIsSuccessTooltipOpen(true);};var openErrorTooltip=function openErrorTooltip(){setIsErrorTooltipOpen(true);};var handleUpdateUser=function handleUpdateUser(_ref3){var name=_ref3.name,description=_ref3.description;api.setUserInfo({currentUser:currentUser,name:name,about:description}).then(function(res){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{name:res.name,about:res.about}));closeAllPopups();}).catch(function(error){console.log(error);});};var handleUpdateAvatar=function handleUpdateAvatar(_ref4){var avatar=_ref4.avatar;api.setUserAvatar({avatar:avatar}).then(function(res){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{avatar:res.avatar}));closeAllPopups();}).catch(function(error){console.log(error);});};var handleAddPlaceSubmit=function handleAddPlaceSubmit(_ref5){var name=_ref5.name,link=_ref5.link;api.addCard({name:name,link:link}).then(function(newCard){setCards([].concat(_toConsumableArray(cards),[newCard]));closeAllPopups();}).catch(function(error){console.log(error);});};var handleCardLike=function handleCardLike(card){var isLiked=card.likes.some(function(c){return c._id===currentUser._id;});api.changeLikeCardStatus(card._id,isLiked?\"DELETE\":\"PUT\").then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);}).catch(function(err){return console.log(err);});};var handleCardDelete=function handleCardDelete(card){api.removeCard(card._id).then(function(res){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);}).catch(function(err){return console.log(err);});};var handleCardClick=function handleCardClick(card){setIsImagePopupOpen(true);setSelectedCard(card);};var closeAllPopups=function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsImagePopupOpen(false);setSelectedCard({});setIsSuccessTooltipOpen(false);setIsErrorTooltipOpen(false);};var handleSignOut=function handleSignOut(){localStorage.removeItem(\"jwt\");setLoggedIn(false);setEmail(\"\");history.push(\"/signin\");};var handleSignIn=function handleSignIn(data){auth.signInUser(data).then(function(_ref6){var token=_ref6.token;localStorage.setItem(\"jwt\",token);validateAndSetUser(token);}).catch(function(err){openErrorTooltip();console.log(err);});};var handleRegister=function handleRegister(data){auth.registerUser(data).then(function(){history.push(\"/signin\");handleSignIn(data);openSuccessTooltip();}).catch(function(err){openErrorTooltip();console.log(err);});};return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:currentUser},/*#__PURE__*/React.createElement(Header,{email:email,loggedIn:loggedIn,onSignOut:handleSignOut}),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(ProtectedRoute,{component:Main,exact:true,path:\"/\",loggedIn:loggedIn,cards:cards,onCardClick:handleCardClick,onCardDelete:handleCardDelete,onCardLike:handleCardLike,onEditProfile:handleEditProfileClick,onEditAvatar:handleEditAvatarClick,onAddPlace:handleAddPlaceClick}),/*#__PURE__*/React.createElement(Route,{path:\"/signin\"},/*#__PURE__*/React.createElement(Login,{onLogin:handleSignIn})),/*#__PURE__*/React.createElement(Route,{path:\"/signup\"},/*#__PURE__*/React.createElement(Register,{onRegister:handleRegister})),/*#__PURE__*/React.createElement(Route,null,/*#__PURE__*/React.createElement(Redirect,{to:loggedIn?\"/\":\"/signin\"}))),loggedIn&&/*#__PURE__*/React.createElement(Footer,null),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/React.createElement(PopupWithImage,{card:selectedCard,isOpen:isImagePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/React.createElement(InfoTooltip,{type:\"success\",isOpen:isSuccessTooltipOpen,onClose:closeAllPopups}),/*#__PURE__*/React.createElement(InfoTooltip,{type:\"error\",isOpen:isErrorTooltipOpen,onClose:closeAllPopups}));}export default App;","map":{"version":3,"sources":["/Users/Marina/Yandex Practicum/around-react/src/components/App.js"],"names":["React","useState","useEffect","Switch","Route","Redirect","useHistory","CurrentUserContext","Header","ProtectedRoute","Main","Footer","PopupWithImage","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Login","Register","InfoTooltip","api","auth","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isSuccessTooltipOpen","setIsSuccessTooltipOpen","isErrorTooltipOpen","setIsErrorTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","loggedIn","setLoggedIn","email","setEmail","history","getAppInfo","then","cardListData","userInfoData","catch","error","console","log","token","localStorage","getItem","validateAndSetUser","validateUser","user","data","push","err","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","openSuccessTooltip","openErrorTooltip","handleUpdateUser","name","description","setUserInfo","about","res","closeAllPopups","handleUpdateAvatar","avatar","setUserAvatar","handleAddPlaceSubmit","link","addCard","newCard","handleCardLike","card","isLiked","likes","some","c","_id","changeLikeCardStatus","newCards","map","handleCardDelete","removeCard","filter","handleCardClick","handleSignOut","removeItem","handleSignIn","signInUser","setItem","handleRegister","registerUser"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Switch, Route, Redirect, useHistory } from \"react-router-dom\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport Header from \"./Header\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithImage from \"./PopupWithImage\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport api from \"../utils/api\";\nimport auth from \"../utils/auth\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [isSuccessTooltipOpen, setIsSuccessTooltipOpen] = useState(false);\n  const [isErrorTooltipOpen, setIsErrorTooltipOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState({});\n  const [currentUser, setCurrentUser] = useState({});\n  const [cards, setCards] = useState([]);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [email, setEmail] = useState(\"\");\n  const history = useHistory();\n\n  useEffect(() => {\n    api\n      .getAppInfo()\n      .then(([cardListData, userInfoData]) => {\n        setCurrentUser(userInfoData);\n        setCards(cardListData);\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n    const token = localStorage.getItem(\"jwt\");\n    if (token) {\n      validateAndSetUser(token);\n    }\n  }, []);\n\n  const validateAndSetUser = (token) => {\n    auth\n      .validateUser(token)\n      .then((user) => {\n        setLoggedIn(true);\n        setEmail(user.data.email);\n        history.push(\"/\");\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarPopupOpen(true);\n  };\n  const handleEditProfileClick = () => {\n    setIsEditProfilePopupOpen(true);\n  };\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  };\n  const openSuccessTooltip = () => {\n    setIsSuccessTooltipOpen(true);\n  };\n  const openErrorTooltip = () => {\n    setIsErrorTooltipOpen(true);\n  };\n  const handleUpdateUser = ({ name, description }) => {\n    api\n      .setUserInfo({ currentUser, name: name, about: description })\n      .then((res) => {\n        setCurrentUser({\n          ...currentUser,\n          name: res.name,\n          about: res.about,\n        });\n        closeAllPopups();\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n  const handleUpdateAvatar = ({ avatar }) => {\n    api\n      .setUserAvatar({ avatar })\n      .then((res) => {\n        setCurrentUser({\n          ...currentUser,\n          avatar: res.avatar,\n        });\n        closeAllPopups();\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  const handleAddPlaceSubmit = ({ name, link }) => {\n    api\n      .addCard({ name, link })\n      .then((newCard) => {\n        setCards([...cards, newCard]);\n        closeAllPopups();\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  const handleCardLike = (card) => {\n    const isLiked = card.likes.some((c) => c._id === currentUser._id);\n    api\n      .changeLikeCardStatus(card._id, isLiked ? \"DELETE\" : \"PUT\")\n      .then((newCard) => {\n        const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  };\n  const handleCardDelete = (card) => {\n    api\n      .removeCard(card._id)\n      .then((res) => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  };\n  const handleCardClick = (card) => {\n    setIsImagePopupOpen(true);\n    setSelectedCard(card);\n  };\n  const closeAllPopups = () => {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsImagePopupOpen(false);\n    setSelectedCard({});\n\n    setIsSuccessTooltipOpen(false);\n    setIsErrorTooltipOpen(false);\n  };\n  const handleSignOut = () => {\n    localStorage.removeItem(\"jwt\");\n    setLoggedIn(false);\n    setEmail(\"\");\n    history.push(\"/signin\");\n  };\n  const handleSignIn = (data) => {\n    auth\n      .signInUser(data)\n      .then(({ token }) => {\n        localStorage.setItem(\"jwt\", token);\n        validateAndSetUser(token);\n      })\n      .catch((err) => {\n        openErrorTooltip();\n        console.log(err);\n      });\n  };\n  const handleRegister = (data) => {\n    auth\n      .registerUser(data)\n      .then(() => {\n        history.push(\"/signin\");\n        handleSignIn(data);\n        openSuccessTooltip();\n      })\n      .catch((err) => {\n        openErrorTooltip();\n        console.log(err);\n      });\n  };\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <Header email={email} loggedIn={loggedIn} onSignOut={handleSignOut} />\n      <Switch>\n        <ProtectedRoute\n          component={Main}\n          exact\n          path=\"/\"\n          loggedIn={loggedIn}\n          cards={cards}\n          onCardClick={handleCardClick}\n          onCardDelete={handleCardDelete}\n          onCardLike={handleCardLike}\n          onEditProfile={handleEditProfileClick}\n          onEditAvatar={handleEditAvatarClick}\n          onAddPlace={handleAddPlaceClick}\n        />\n        <Route path=\"/signin\">\n          <Login onLogin={handleSignIn} />\n        </Route>\n        <Route path=\"/signup\">\n          <Register onRegister={handleRegister} />\n        </Route>\n        <Route>\n          <Redirect to={loggedIn ? \"/\" : \"/signin\"} />\n        </Route>\n      </Switch>\n      {loggedIn && <Footer />}\n      <EditProfilePopup\n        isOpen={isEditProfilePopupOpen}\n        onClose={closeAllPopups}\n        onUpdateUser={handleUpdateUser}\n      />\n      <EditAvatarPopup\n        isOpen={isEditAvatarPopupOpen}\n        onClose={closeAllPopups}\n        onUpdateAvatar={handleUpdateAvatar}\n      />\n      <AddPlacePopup\n        isOpen={isAddPlacePopupOpen}\n        onClose={closeAllPopups}\n        onAddPlace={handleAddPlaceSubmit}\n      />\n      <PopupWithImage\n        card={selectedCard}\n        isOpen={isImagePopupOpen}\n        onClose={closeAllPopups}\n      />\n      <InfoTooltip\n        type=\"success\"\n        isOpen={isSuccessTooltipOpen}\n        onClose={closeAllPopups}\n      />\n      <InfoTooltip\n        type=\"error\"\n        isOpen={isErrorTooltipOpen}\n        onClose={closeAllPopups}\n      />\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}